'use client';

import { useEffect, useRef } from 'react';
import { gsap, DrawSVGPlugin, MotionPathPlugin, ScrollTrigger } from '@/lib/gsap';

gsap.registerPlugin(DrawSVGPlugin, MotionPathPlugin, ScrollTrigger);

export default function AnimatedRoad() {
  const containerRef = useRef<HTMLDivElement>(null);
  const svgRef = useRef<SVGSVGElement>(null);
  const carRef = useRef<SVGGElement>(null);
  const pathRef = useRef<SVGPathElement>(null);

  useEffect(() => {
    if (!svgRef.current || !carRef.current || !pathRef.current) return;

    const path = pathRef.current;
    const car = carRef.current;

    // Use a timeline to sync animations
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: document.body,
        start: 'top top',
        end: 'bottom bottom',
        scrub: 1.5,
      },
    });

    // Animate the path drawing
    tl.fromTo(
      path,
      { drawSVG: '0%' },
      { drawSVG: '100%', duration: 1, ease: 'none' },
      0
    );

    // Animate the car along the path
    tl.to(
      car,
      {
        motionPath: {
          path: path,
          align: path,
          alignOrigin: [0.5, 0.5],
          autoRotate: true,
        },
        duration: 1,
        ease: 'none',
      },
      0
    );
  }, []);

  return (
    <div ref={containerRef} className="absolute top-0 left-0 w-full h-full z-[-1] pointer-events-none overflow-hidden">
      <svg
        ref={svgRef}
        id="linesvg"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 -77.327 1509.71 6300"
        preserveAspectRatio="xMidYMax meet"
        className="absolute top-0 left-1/2 -translate-x-1/2 h-full"
        style={{ width: '100%', maxWidth: '1509.71px' }}
      >
        <style type="text/css">{`
            .st0{fill:none;stroke:#4a7ec2;stroke-width:5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
        `}</style>
        <path
          id="motionPath"
          ref={pathRef}
          className="st0"
          d="M 249.052 140.282 C 244.58 163.258 141.638 974.649 410.733 1231.39 C 757.328 1562.06 1408.95 1194.48 1403.32 1857.45 C 1399.36 2324.44 18.761 2227.88 22.583 2752.4 C 25.887 3205.66 1408.09 3114.83 1403.22 3512.01 C 1394.53 4222.6 81.675 4076.55 80.718 4512.32 C 79.013 5285.71 1411.56 5070.93 1411.64 5443.08 C 1411.77 6055.59 219.258 6075.13 219.258 6075.13"
        />
        <g id="motionSVG" ref={carRef}>
          <g id="g786" transform="matrix(-1.005947, 0, 0, -1.005947, 414.845123, 477.148285)">
            <path id="path787" fill="#xcsx" d="M-43.37,694.736c-5.837-0.343-11.878-0.414-17.669,0.362 c-3.812,0.759-12.237,4.018-8.165,9.254c5.595,5.377,15.498,4.553,22.569,3.95l0.548,6.393c-9.736,0.8-21.507,1.058-28.627-6.75 c-6.379-10.154,3.601-17.49,12.825-19.216c6.167-0.782,12.333-0.373,18.518-0.734L-43.37,694.736L-43.37,694.736z"></path>
            <path id="path788" fill="#4A00AD" d="M-43.37,728.46c-5.837,0.342-11.878,0.414-17.669-0.363 c-3.812-0.759-12.237-4.018-8.165-9.254c5.595-5.377,15.498-4.553,22.569-3.95l0.548-6.393c-9.736-0.8-21.507-1.058-28.627-6.75 c-6.379,10.155,3.601,17.49,12.825,19.216c6.167,0.782,12.333,0.373,18.518,0.734L-43.37,728.46L-43.37,728.46z"></path>
            <path id="path789" fill="#4A00AD" d="M-20.595,713.818c-2.202-0.21-4.466-0.119-6.673-0.131c-1.868-0.006-8.14-0.962-9.303,1.064 c-0.41,1.444,0.288,3.097,1.502,3.904c2.941,1.512,6.912,0.742,10.068,0.59c3.86-0.185,9.098-0.611,10.277,4.087 c0.365,3.836-2.024,7.516-5.007,9.742c-3.944,2.426-8.436,1.978-12.836,1.423c-2.62-0.348-5.233-0.749-7.86-1.044l0.483-4.055 c2.636,0.314,5.254,0.75,7.885,1.099c3.218,0.394,6.911,0.992,9.856-0.722c1.696-1.197,3.331-3.406,3.344-5.57 c0.016-1.612-5.018-0.976-5.934-0.93c-4.258,0.228-8.887,0.915-12.751-1.287c-3.112-2.333-4.487-6.792-2.073-10.116 c3.153-2.994,8.341-2.221,12.348-2.234c2.207-0.011,4.471,0.081,6.673-0.129V713.818L-20.595,713.818z"></path>
            <g id="g790" transform="matrix(1.166 0 0 1.0624 -26.21 -45.238)">
                <path id="path791" fill="#4A00AD" d="M7.758,710.522c2.191,0.243,4.459,0.147,6.658,0.16c4.147,0.016,8.293-0.018,12.442-0.036 c0.831-0.005,1.663-0.012,2.493-0.039v3.442c-0.831-0.028-1.663-0.034-2.493-0.04c-4.148-0.018-8.295-0.052-12.442-0.036 c-2.199,0.013-4.467-0.083-6.658,0.16V710.522L7.758,710.522z"></path>
                <path id="path792" fill="#4A00AD" d="M19.975,713.045c-0.17,1.325-0.085,2.721-0.093,4.051c-0.012,2.653-0.013,5.307,0.007,7.962 c0.013,1.758,0.029,3.516,0.034,5.273c0.001,1.052-0.003,2.104-0.005,3.156h-3.542c-0.002-1.052-0.005-2.104-0.003-3.156 c0.003-1.758,0.02-3.516,0.033-5.273c0.019-2.655,0.019-5.308,0.008-7.962c-0.01-1.33,0.077-2.726-0.094-4.051H19.975z"></path>
            </g>
            <g id="g793">
                <path id="path794" fill="#4A00AD" d="M12.991,710.382c-0.233,1.819-0.121,3.735-0.143,5.564 c-0.049,4.597-0.055,9.195-0.009,13.793c0.019,1.505,0.041,3.011,0.07,4.516H9.416c0.029-1.505,0.053-3.011,0.07-4.516 c0.046-4.598,0.04-9.196-0.008-13.793c-0.022-1.829,0.091-3.745-0.144-5.564H12.991L12.991,710.382z"></path>
                <path id="path795" fill="#4A00AD" d="M10.804,709.284c1.504,0.167,3.054,0.079,4.565,0.121c3.229,0.147,6.067,1.089,6.49,4.705 c0.098,3.621-1.89,5.792-5.406,6.463c-1.649,0.208-3.262,0.145-4.911-0.031l0.377-3.377c1.302,0.146,2.583,0.213,3.887,0.054 c1.712-0.315,2.579-0.938,2.565-2.747c-0.132-1.637-1.703-1.587-3.088-1.653c-1.475-0.03-3.009-0.086-4.479,0.078V709.284 L10.804,709.284z"></path>
                <path id="path796" fill="#4A00AD" d="M12.244,718.957c1.304,0.145,2.657,0.077,3.967,0.087c2.814,0.022,5.97-0.196,8.307,1.637 c1.977,2.09,1.296,4.663,0.556,7.142c-0.503,1.677-0.932,3.325-0.986,5.084c-0.003,0.344,0,0.684,0.009,1.026l-3.525,0.09 c-0.011-0.409-0.014-0.816-0.01-1.225c0.066-2.06,0.562-3.992,1.154-5.955c0.269-0.9,1.017-2.566,0.519-3.509 c-1.19-1.353-4.451-0.867-6.022-0.854c-1.31,0.011-2.663-0.057-3.967,0.087V718.957L12.244,718.957z"></path>
                <rect id="rect797" x="9.365" y="709.294" fill="#4A00AD" width="2.51" height="3.227"></rect>
            </g>
            <path id="path798" fill="#4A00AD" d="M51.312,722.018c0,7.421-5.542,13.445-12.37,13.445s-12.368-6.024-12.368-13.445 c0-7.422,5.54-13.445,12.368-13.445S51.312,714.596,51.312,722.018L51.312,722.018z M47.367,721.675 c0,5.055-3.775,9.158-8.426,9.158c-4.651,0-8.426-4.103-8.426-9.158c0-5.057,3.774-9.158,8.426-9.158 C43.592,712.516,47.367,716.619,47.367,721.675z"></path>
        </g>
        <g id="g854" transform="matrix(-1.005947, 0, 0, -1.005947, 442.221588, 521.119751)">
            <path id="path855" fill="#C2C2C2" d="M-13.435,694.736c-5.837-0.343-11.878-0.414-17.669,0.362 c-3.812,0.759-12.237,4.018-8.165,9.254c5.595,5.377,15.498,4.553,22.569,3.95l0.548,6.393c-9.736,0.8-21.507,1.058-28.627-6.75 c-6.379-10.154,3.601-17.49,12.825-19.216c6.167-0.782,12.333-0.373,18.518-0.734L-13.435,694.736L-13.435,694.736z"></path>
            <path id="path856" fill="#FFFFFF" d="M-13.435,728.46c-5.837,0.342-11.878,0.414-17.669-0.363 c-3.812-0.759-12.237-4.018-8.165-9.254c5.595-5.377,15.498-4.553,22.569-3.95l0.548-6.393c-9.736-0.8-21.507-1.058-28.627-6.75 c-6.379,10.155,3.601,17.49,12.825,19.216c6.167,0.782,12.333,0.373,18.518,0.734L-13.435,728.46L-13.435,728.46z"></path>
            <path id="path857" fill="#FFFFFF" d="M9.379,713.818c-2.202-0.21-4.466-0.119-6.673-0.131c-1.868-0.006-8.14-0.962-9.303,1.064 c-0.41,1.444,0.288,3.097,1.502,3.904c2.941,1.512,6.912,0.742,10.068,0.59c3.86-0.185,9.098-0.611,10.277,4.087 c0.365,3.836-2.024,7.516-5.007,9.742c-3.944,2.426-8.436,1.978-12.836,1.423c-2.62-0.348-5.233-0.749-7.86-1.044l0.483-4.055 c2.636,0.314,5.254,0.75,7.885,1.099c3.218,0.394,6.911,0.992,9.856-0.722c1.696-1.197,3.331-3.406,3.344-5.57 c0.016-1.612-5.018-0.976-5.934-0.93c-4.258,0.228-8.887,0.915-12.751-1.287c-3.112-2.333-4.487-6.792-2.073-10.116 c3.153-2.994,8.341-2.221,12.348-2.234c2.207-0.011,4.471,0.081,6.673-0.129V713.818L9.379,713.818z"></path>
            <g id="g858" transform="matrix(1.166 0 0 1.0624 3.725 -45.238)">
                <path id="path859" fill="#FFFFFF" d="M7.758,710.522c2.191,0.243,4.459,0.147,6.658,0.16c4.147,0.016,8.293-0.018,12.442-0.036 c0.831-0.005,1.663-0.012,2.493-0.039v3.442c-0.831-0.028-1.663-0.034-2.493-0.04c-4.148-0.018-8.295-0.052-12.442-0.036 c-2.199,0.013-4.467-0.083-6.658,0.16V710.522L7.758,710.522z"></path>
                <path id="path860" fill="#FFFFFF" d="M19.975,713.045c-0.17,1.325-0.085,2.721-0.093,4.051c-0.012,2.653-0.013,5.307,0.007,7.962 c0.013,1.758,0.029,3.516,0.034,5.273c0.001,1.052-0.003,2.104-0.005,3.156h-3.542c-0.002-1.052-0.005-2.104-0.003-3.156 c0.003-1.758,0.02-3.516,0.033-5.273c0.019-2.655,0.019-5.308,0.008-7.962c-0.01-1.33,0.077-2.726-0.094-4.051H19.975z"></path>
            </g>
            <g id="g861">
                <path id="path862" fill="#FFFFFF" d="M12.991,710.382c-0.233,1.819-0.121,3.735-0.143,5.564 c-0.049,4.597-0.055,9.195-0.009,13.793c0.019,1.505,0.041,3.011,0.07,4.516H9.416c0.029-1.505,0.053-3.011,0.07-4.516 c0.046-4.598,0.04-9.196-0.008-13.793c-0.022-1.829,0.091-3.745-0.144-5.564H12.991L12.991,710.382z"></path>
                <path id="path863" fill="#FFFFFF" d="M10.804,709.284c1.504,0.167,3.054,0.079,4.565,0.121c3.229,0.147,6.067,1.089,6.49,4.705 c0.098,3.621-1.89,5.792-5.406,6.463c-1.649,0.208-3.262,0.145-4.911-0.031l0.377-3.377c1.302,0.146,2.583,0.213,3.887,0.054 c1.712-0.315,2.579-0.938,2.565-2.747c-0.132-1.637-1.703-1.587-3.088-1.653c-1.475-0.03-3.009-0.086-4.479,0.078V709.284 L10.804,709.284z"></path>
                <path id="path864" fill="#FFFFFF" d="M12.244,718.957c1.304,0.145,2.657,0.077,3.967,0.087c2.814,0.022,5.97-0.196,8.307,1.637 c1.977,2.09,1.296,4.663,0.556,7.142c-0.503,1.677-0.932,3.325-0.986,5.084c-0.003,0.344,0,0.684,0.009,1.026l-3.525,0.09 c-0.011-0.409-0.014-0.816-0.01-1.225c0.066-2.06,0.562-3.992,1.154-5.955c0.269-0.9,1.017-2.566,0.519-3.509 c-1.19-1.353-4.451-0.867-6.022-0.854c-1.31,0.011-2.663-0.057-3.967,0.087V718.957L12.244,718.957z"></path>
                <rect id="rect865" x="9.365" y="709.294" fill="#FFFFFF" width="2.51" height="3.227"></rect>
            </g>
            <path id="path866" fill="#FFFFFF" d="M51.312,722.018c0,7.421-5.542,13.445-12.37,13.445s-12.368-6.024-12.368-13.445 c0-7.422,5.54-13.445,12.368-13.445S51.312,714.596,51.312,722.018L51.312,722.018z M47.367,721.675 c0,5.055-3.775,9.158-8.426,9.158c-4.651,0-8.426-4.103-8.426-9.158c0-5.057,3.774-9.158,8.426-9.158 C43.592,712.516,47.367,716.619,47.367,721.675z"></path>
        </g>
        <g id="g854-3" transform="matrix(-1.005947, 0, 0, -1.005947, 442.221588, 521.119751)">
            <path id="path184-4" fill="#4A7EC2" d="M 430.86 551.081 C 309.548 553.615 290.956 531.854 273.028 528.27 C 255.105 486.667 251.702 135.881 262.454 107.202 C 270.493 42.249 257.158 31.494 253.133 -46.79 C 245.473 -138.21 263.664 -87.377 248.371 -180.34 C 271.608 -277.14 227.841 -279.11 429.174 -288.31 C 613.936 -285.73 587.919 -277.13 611.147 -180.34 C 595.853 -87.375 614.045 -138.21 606.384 -46.789 C 602.36 31.49 589.025 42.245 597.063 107.203 C 607.816 135.878 604.414 486.663 586.49 528.271 C 558.43 544.528 484.072 551.082 430.846 551.082 L 430.86 551.081 L 430.86 551.081 Z" style="stroke-width: 1.006;"></path>
            <path id="path230-0" fill="#E6E6E6" d="M 279.012 -241.21 C 266.495 -221.18 267.407 -30.683 287.435 -15.663 C 306.779 -31.596 418.843 -46.397 440.151 -45.022 C 461.917 -46.622 547.111 -36.379 573.286 -20.67 C 580.343 -18.384 594.451 -241.2 574.423 -256.22 C 511.828 -273.76 304.041 -273.76 279.012 -241.21 L 279.012 -241.21 Z" style="stroke-width: 1.006;"></path>
        </g>
      </svg>
    </div>
  );
}
